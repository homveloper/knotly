목표: 마크다운 파일 기반 마인드맵 노트앱으로 전환하여 로컬 파일 저장, 텍스트 편집 가능성, 조합형 토큰 시스템을 구현한다. 사용자가 .knotly.md 파일로 노트를 저장하고, 텍스트 에디터에서 직접 편집하며, Tailwind 스타일의 조합형 토큰으로 노드 스타일을 정의할 수 있도록 한다.

핵심 기능: 파일 I/O 시스템. 시작 화면에서 새 노트 만들기 버튼을 클릭하면 기본 토큰 라이브러리가 포함된 빈 캔버스가 생성된다. 파일 열기 버튼을 클릭하면 File System Access API를 통해 .knotly.md 파일을 선택할 수 있고, 드래그 앤 드롭으로도 파일을 로드할 수 있다. YAML frontmatter를 파싱하여 tokens, nodes, edges 정보를 추출하고 Zustand store에 로드한다. 마크다운 본문의 [id] 구분자로 노드 내용을 파싱한다. Cmd/Ctrl+S 단축키로 현재 상태를 마크다운으로 직렬화하여 파일 시스템에 저장한다. 조합형 토큰 시스템. tokens 섹션에서 원자적 토큰(color-blue, h3, bold 등)과 완성형 토큰(heading-primary: "color-blue h3 bold")을 정의한다. 노드의 style 속성은 토큰 조합 문자열을 받아 파서가 각 토큰을 순서대로 병합하여 최종 스타일 객체를 생성한다. 토큰 파서는 공백으로 분리된 토큰 이름을 순회하며 tokens 객체에서 값을 찾아 Object.assign으로 병합한다. 완성형 토큰이 문자열 값을 가지면 재귀적으로 파싱한다. 충돌 시 마지막 토큰이 우선순위를 갖는다. 스타일 편집 UI. 노드 우클릭 시 스타일 선택 패널이 나타나고, Colors(color-blue, color-red 등), Sizes(h2~h6), Feel(smooth, neat, sketchy), Border(thin, thick) 카테고리별 버튼을 제공한다. 버튼 클릭 시 현재 조합 문자열에 토큰을 추가하거나 제거하고 실시간으로 노드에 반영한다. 하단에 현재 조합 문자열(예: "color-blue h4 neat")을 표시한다. 노드 연결 시스템. 시나리오 1: 노드가 선택된 상태에서 빈 공간을 더블클릭/터치하면 새 노드가 생성되고 선택된 노드와 자동으로 연결되며 포커스가 새 노드로 이동한다. 시나리오 2: 데스크톱에서는 노드 가장자리를 드래그하여 다른 노드 위에 드롭하면 연결을 생성한다. 모바일에서는 노드를 롱프레스하여 "연결 대기" 상태로 전환하고 다른 노드를 탭하면 연결을 생성한다. 파일 관리 UX. 상단 타이틀바에 파일명을 표시하고, 변경사항이 있으면 파일명 옆에 ● 표시, 저장되면 ✓ 표시를 보여준다. 최근 파일 목록을 로컬스토리지에 저장하고 시작 화면에 표시한다. 기존 기능 유지. Milestone 2의 모든 기능(노드 CRUD, 드래그 이동, 캔버스 줌/팬, rough.js 렌더링, 터치 제스처)을 유지하되 스타일 시스템은 토큰 기반으로 전환하고 연결 방식은 자동 연결과 드래그 방식으로 개선한다.

입출력 명세: 입력은 .knotly.md 파일, 사용자 제스처, 텍스트 입력이다. 파일 열기 시 File System Access API의 showOpenFilePicker()를 호출하여 파일 핸들을 받고, file.text()로 내용을 읽는다. YAML frontmatter는 js-yaml 라이브러리로 파싱하여 {tokens: {}, nodes: [], edges: []} 객체를 얻는다. tokens 객체의 각 키-값 쌍을 토큰 정의로 저장한다. nodes 배열의 각 요소에서 id, pos, style을 추출하고, 마크다운 본문에서 [id]로 시작하는 섹션을 찾아 다음 [id]까지의 텍스트를 content로 추출한다. edges 배열의 각 요소는 [fromId, toId] 형태이므로 이를 {id: UUID, fromId, toId, lineStyle: 'dashed', createdAt} 형태로 변환한다. 저장 시 Zustand store의 현재 상태를 YAML frontmatter 문자열로 직렬화하고, 노드 배열을 순회하며 [id]\\n{content}\\n\\n 형태로 본문 문자열을 생성한다. 두 문자열을 결합하여 완전한 마크다운 문자열을 만들고 File System Access API의 createWritable()로 파일에 쓴다. 토큰 파싱 입력은 style 문자열(예: "color-blue h3 bold")이고, 출력은 스타일 객체 {stroke, fill, width, height, fontSize, strokeWidth, roughness}이다. 스타일 편집 UI 입력은 버튼 클릭 이벤트이고, 출력은 업데이트된 style 문자열이다.

데이터 구조: .knotly.md 파일 구조는 YAML frontmatter + 마크다운 본문이다. frontmatter는 tokens, nodes, edges 세 섹션을 포함한다. tokens는 {[tokenName: string]: TokenValue} 형태이며, TokenValue는 스타일 속성 객체 또는 토큰 조합 문자열이다. nodes는 {id: string, pos: [number, number], style: string}[] 형태이다. edges는 [string, string][] 형태로 간결하게 표현한다. 마크다운 본문은 [id]\\n{content}\\n\\n 패턴이 반복된다. Zustand store는 기존 구조에 tokenDefinitions: {[name: string]: TokenDefinition}, currentFilePath: string | null, hasUnsavedChanges: boolean, recentFiles: string[] 필드를 추가한다. TokenDefinition은 {type: 'atomic' | 'composite', value: StyleObject | string} 형태이다. StyleObject는 {stroke?: string, fill?: string, width?: number, height?: number, fontSize?: number, fontWeight?: number, strokeWidth?: number, roughness?: number}이다. Node 타입의 style 필드는 기존 객체 형태에서 문자열(토큰 조합)로 변경된다.

기능적 제약사항: 텍스트 서식은 지원하지 않는다. 노드 내용은 플레인 텍스트만 가능하다. 이미지, 첨부파일은 지원하지 않는다. 실시간 협업 기능은 없다. 클라우드 동기화는 없으며 로컬 파일만 지원한다. 커스텀 테마 편집기는 제공하지 않으며, 토큰은 텍스트 에디터에서 직접 편집한다. 기본 토큰 라이브러리는 8가지 색상(color-blue, red, mint, yellow, gray, purple, orange, pink), 6가지 크기(h1~h6), 5가지 느낌(smooth, neat, rough, sketchy, messy), 4가지 테두리(thin, normal, thick, bold), 2가지 선 스타일(dashed, solid)을 제공한다.

완료 조건: 시작 화면에 새 노트 만들기와 파일 열기 버튼이 표시된다. 새 노트를 만들면 기본 토큰 라이브러리가 포함된 빈 캔버스가 나타난다. 캔버스 빈 공간을 더블클릭/더블터치하면 해당 지점에 노드가 생성되고 즉시 텍스트 입력 모드로 전환된다. 노드가 선택된 상태에서 빈 공간을 더블클릭하면 새 노드가 생성되며 자동으로 연결된다. 노드 가장자리를 드래그하여 다른 노드로 드롭하면 연결이 생성된다(데스크톱). 노드를 롱프레스한 후 다른 노드를 탭하면 연결이 생성된다(모바일). 노드를 우클릭으로 스타일 선택 패널을 열어 토큰 조합을 선택하면 노드 스타일이 즉시 변경된다. Cmd+S로 .knotly.md 파일로 저장된다. 텍스트 에디터로 파일을 열면 YAML frontmatter의 tokens 정의와 마크다운 본문의 [id] 구분자로 노드 내용이 보인다. tokens 섹션에 새 토큰을 추가하고 앱에서 다시 열면 스타일 선택 패널에 새 토큰이 나타난다. 드래그 앤 드롭으로 파일을 로드하면 모든 노드와 연결선이 복원된다. 파일명이 타이틀바에 표시되고 변경사항이 있으면 ● 표시, 저장 후 ✓ 표시가 나타난다. 최근 파일 목록이 시작 화면에 표시된다.
